(function(){var e,t,n,r,i,o,a,s,u,l,c,d,h,f;i=window.ww||(window.ww={}),l={SHARE_SHOW:function(e,t){return e.sharePanel=!0,e.sharePanelActivePanel=null!=t.panel?t.panel:"main",e.canIAdminister?e.sharePanelActiveTab=t.tab||"privacy":e.sharePanelActiveTab="goOutside",e},SHARE_HIDE:function(e){return e.sharePanel=!1,e.isFirstViewFlow=!1,e.sharePanelPrivacyFetched=!1,e},SHARE_TOGGLE:function(e,t){return e.sharePanel?this.SHARE_HIDE(e):this.SHARE_SHOW(e,t)},SHARE_PRIVACY_SYNC_SUCCESS:function(e){return e},SHARE_PRIVACY_SYNC_FAILED:function(e,t){return e.sharePanelError=t.error,e},SHARE_NAVIGATE:function(e,t){return e.sharePanelActiveTab=t.tabName,e},SHARE_NAVIGATE_PANEL:function(e,t){return e.embedPanel="embed"===t.panelName,e.sharePanelActivePanel=t.panelName,e}},a={WISH_LIST_MOUNTED:function(e){return e.wishListMounted=!0,e},FETCHED_POSTS:function(e){var t,n;return e.postsFetched=!0,e.expandedPostId&&$device.app&&(t=e.posts.get(e.expandedPostId),e.expandedPostId=null,t&&(ww.$state.wishUrls=e.posts.map(function(){return function(t){return window.location.protocol+"//"+window.location.host+"/walls/"+e.wall.id+"/wishes/"+t.id+".html"}}(this)),n=e.posts.indexOf(t),window.location.href=window.location.protocol+"//"+window.location.host+"/ios-app/expand-post?selected_index="+n)),e},NEW_POST_REMOTE:function(e,t){var n;return n=new Wallwisher.Models.Wish(t.postAttributes),(n.get("published")||e.canIModerate||n.authoredBy(e.user))&&e.posts.add(n),e},EDIT_POST_REMOTE:function(e,t){var n,r;return n=null!=(r=e.posts)?r.get(t.postAttributes.id):void 0,n&&n.get("updated_at")<=t.postAttributes.updated_at&&(n.get("published")||e.canIModerate||n.authoredBy(e.user)?n.set(t.postAttributes):e.posts.remove(n)),e},DELETE_POST_REMOTE:function(e,t){var n;return n=e.posts.get(t.postAttributes.id),n&&(n===e.transferPost&&this.END_POST_TRANSFER(e),n===e.copyPost&&this.END_POST_COPY(e),n===e.postUnderAction&&this.HIDE_POST_ACTION_MENU(e),e.posts.remove(t.postAttributes.id)),e},CLEAR_ALL_POSTS:function(e){return e.clearAllDialog=!1,_.defer(function(){var t,n;for(n=[];t=e.posts.first();)n.push(t.destroy());return n}),e},APPROVE_POST:function(e,t){var n;return n=e.posts.get(t.postId),null!=n&&n.approve(),e},MOVED_POST:function(e,t){var n;return n=t.post,n.set({left:t.position.left,top:t.position.top}),n.isNew()||n.save(),e},SORTED_POST:function(e,t){var n,r,i;return n=e.posts.get(t.postId),null!=t.sectionId&&(r=e.wallSections.get(t.sectionId)),n&&(i={sort_index:t.sortIndex},null!=r&&(i.wall_section_id=r.id),n.set(i),n.isNew()||n.save()),e},RESIZED_POST:function(e,t){var n;return n=t.post,n.set({width:t.size.width}),n.isNew()||n.save(),e},CREATE_POST:function(e,t){var n,r;return n=t.post,r=e.wallSections.filter(function(){return function(e){return e.id}}(this)),e.canHaveSections&&!t.post.wall_section_id&&1!==r.length?e.pendingPosts=e.pendingPosts.concat([n]):(e.canHaveSections&&!t.post.wall_section_id&&1===r.length&&(n=Object.assign({wall_section_id:r[0].id},n)),n.file?e.pendingPosts=e.pendingPosts.concat([n]):(n=$buildPost(n,e),e.posts.create(n))),e},COMPLETE_POST_UPLOAD:function(e,t){var n;return n=_.findWhere(e.pendingPosts,function(){return function(e){return e.file===t.file}}(this)),e.pendingPosts=_.reject(e.pendingPosts,function(){return function(e){return e.file===t.file}}(this)),"error"!==t.status&&"cancel"!==t.status&&(n=Object.assign(n,{attachment:t.status}),n=$buildPost(n,e),e.posts.create(n)),e},PICK_SECTION:function(e,t){var n,r,i,o,a,s,u;for(a=[],s=e.pendingPosts,r=0,i=s.length;r<i;r++)o=s[r],o.wall_section_id||(o.wall_section_id=t.sectionId,o.file||(o.subject||o.body||o.attachment?(n=$buildPost(o,e),e.posts.create(n),a.push(o)):(n=$buildPost(o,e),(null!=(u=e.postBeingEdited)?u.isEmpty():void 0)&&e.postBeingEdited.destroy(),e.postBeingEdited=new Wallwisher.Models.Wish(n),e.posts.add(e.postBeingEdited),a.push(o))));return e.pendingPosts=_.difference(e.pendingPosts,a),e},CANCEL_PICKING_SECTION:function(e){return e.canHaveSections&&(e.pendingPosts=e.pendingPosts.filter(function(e){return e.wall_section_id})),e},DELETE_POST:function(e,t){var n,r,i,o,a;if(t.post===e.postBeingEdited&&(e.postBeingEdited=null),t.post.destroy(),(null!=(o=e.postConnections)?o.length:void 0)>0)for(a=e.postConnections.allConnectionsToAndFromWish(t.post),r=0,i=a.length;r<i;r++)n=a[r],e.postConnections.remove(n);return e},START_NEW_POST:function(e,t){var n,r,i;return n=t.post,i=e.wallSections.filter(function(){return function(e){return e.id}}(this)),e.canHaveSections&&!t.post.wall_section_id&&1!==i.length?e.pendingPosts=e.pendingPosts.concat([n]):(e.canHaveSections&&!t.post.wall_section_id&&1===i.length&&(n=Object.assign({wall_section_id:i[0].id},n)),(null!=(r=e.postBeingEdited)?r.isEmpty():void 0)&&e.postBeingEdited.destroy(),n=$buildPost(n,e),e.postBeingEdited=new Wallwisher.Models.Wish(n),"chat"!==e.wallLayout&&e.posts.add(e.postBeingEdited)),e},SAVE_POST:function(e,t){var n,r,i;return t.postAttributes.id?(n=e.posts.get(t.postAttributes.id),n.save(t.postAttributes)):(r=$buildPost(t.postAttributes,e),e.posts.create(r)),e.postBeingEdited=null,"chat"===e.wallLayout&&((null!=(i=e.postBeingEdited)?i.isEmpty():void 0)&&e.postBeingEdited.destroy(),r=$buildPost({},e),e.postBeingEdited=new Wallwisher.Models.Wish(r)),e},CHANGE_POST_COLOR:function(e,t){var n;return n=t.post,n.save("color",t.newBgColor),e},REMOVE_POST_COLOR:function(e,t){var n;return n=t.post,n.save("color",""),e},CHANGE_POST_ATTACHMENT:function(e,t){var n;return n=t.post||e.posts.get(t.postAttributes.id),n.save("attachment",t.postAttributes.attachment),e},CHANGE_POST_TEXT:function(e,t){var n;return n=t.post||e.posts.get(t.postAttributes.id),"chat"===e.wallLayout&&n.isNew()?n.set(t.postAttributes):n.dsave(t.postAttributes),e},REMOVE_POST_ATTACHMENT:function(e,t){var n;return n=t.post||e.posts.get(t.postAttributes.id),"chat"===e.wallLayout&&n.isNew()?n.set("attachment",""):n.save("attachment",""),e},START_EDITING_POST:function(e,t){return e=this.STOP_EDITING_POST(e,t),e.postBeingEdited=t.post,e},STOP_EDITING_POST:function(e){var t;return(null!=(t=e.postBeingEdited)?t.isEmpty():void 0)&&e.postBeingEdited.destroy(),e.postBeingEdited=null,e},START_POST_TRANSFER:function(e,t){return e.transferPostPanel=!0,e.transferPost=t.transferPost,e},UPDATE_POST_TRANSFER:function(e,t){var n;return n=t.transferredPost.id,null!=n&&e.posts.remove({id:n}),e},POST_TRANSFER_NAVIGATE:function(e,t){return e.transferPostActivePanel=t.panel,e},END_POST_TRANSFER:function(e){return e.transferPostPanel=!1,e.transferPost=null,e.transferPostActivePanel="main",this.PADLETSELECTOR_DONE(e),e},START_POST_COPY:function(e,t){return e.copyPostPanel=!0,e.copyPost=t.copyPost,e},POST_COPY_NAVIGATE:function(e,t){return e.copyPostActivePanel=t.panel,e},END_POST_COPY:function(e){return e.copyPostPanel=!1,e.copyPost=null,e.copyPostActivePanel="main",this.PADLETSELECTOR_DONE(e),e},EXPAND_POST:function(e,t){var n,r,i;return $device.app?(n=t.post?t.post:e.posts.get(t.postId),n&&(ww.$state.wishUrls=e.posts.map(function(){return function(t){return window.location.protocol+"//"+window.location.host+"/walls/"+e.wall.id+"/wishes/"+t.id+".html"}}(this)),r=e.posts.indexOf(n),window.location.href=window.location.protocol+"//"+window.location.host+"/ios-app/expand-post?selected_index="+r)):e.expandedPostId=(null!=(i=t.post)?i.id:void 0)||t.postId,e.zoomedPostId=null,e.zoomedLink=null,e},UNEXPAND_POST:function(e){return e.expandedPostId=null,e},ZOOM_POST:function(e,t){return e.zoomedPostId=t.zoomedPostId,e.zoomedLink=t.zoomedLink,e.expandedPostId=null,e},UNZOOM_POST:function(e){return e.zoomedPostId=null,e.zoomedLink=null,e.expandedPostId=null,e},TOGGLE_POST_ACTION_MENU:function(e,t){return e.postUnderAction?e.postUnderAction=null:e.postUnderAction=t.post,e},HIDE_POST_ACTION_MENU:function(e){return e.postUnderAction=null,e},RESIZE_EDITOR:function(e,t){return e.editorHeight=t.height,e}},n={GET_CONTENT:function(e,t){return e.contentSourceMenu=!1,e.contentSourceMenuPosition=null,e.activeContentSource=t.source,e},CLOSE_CONTENT_SOURCE:function(e){return e.activeContentSource=null,e},SAVE_CONTENT:function(e,t){var n;return e.activeContentSource=null,n=e.postBeingEdited,t.content.link?"chat"===e.wallLayout&&n.isNew()?n.set("attachment",t.content.link):n.save("attachment",t.content.link):n.set("file",t.content.file),e},CHOOSE_CONTENT_SOURCE:function(e,t){return e.contentSourceMenu=!0,e.contentSourceMenuPosition=t.position,e},CLOSE_CONTENT_SOURCE_MENU:function(e){return e.contentSourceMenu=!1,e.contentSourceMenuPosition=null,e}},r={FILE_PICKER_SHOW:function(e,t){return e.filePickerPanel=!0,e.filePickerPanelTitle=t.options.title,e.filePickerPanelTypes=t.options.types,e.filePickerPanelOnSuccess=t.options.success,e.filePickerPanelOnClose=t.options.close,e},FILE_PICKER_HIDE:function(e){return e.filePickerPanel=!1,e}},f={FETCHED_PADLET:function(e,t){return e.wall.set(t.wallAttributes),e.wallLayout=e.wall.attributes.viz,e.wallColorScheme=e.wall.attributes.color_scheme,e.wallShowAuthor=e.wall.attributes.show_author,e.wallIsCommentable=e.wall.attributes.is_commentable,e.wallIsReactable=e.wall.attributes.is_reactable,e.wallReactionData=e.wall.attributes.reaction_data,e.wallNewPostLoc=e.wall.attributes.new_wish_loc,e},EDIT_WALL_REMOTE:function(e,t){return e.wall.get("updated_at")<=t.wallAttributes.updated_at&&(e.wall.set(t.wallAttributes),e.wallLayout=e.wall.attributes.viz,e.wallColorScheme=e.wall.attributes.color_scheme,e.wallShowAuthor=e.wall.attributes.show_author,e.wallIsCommentable=e.wall.attributes.is_commentable,e.wallIsReactable=e.wall.attributes.is_reactable,e.wallReactionData=e.wall.attributes.reaction_data,e.wallNewPostLoc=e.wall.attributes.new_wish_loc),e},DELETE_WALL_REMOTE:function(e){return window.location="/",e},DELETE_WALL:function(e){return e.wall.destroy({success:function(){return window.location="/"}}),e},LIKE_PADLET:function(e){return $.ajax({type:"post",url:"/api/wall_likes",data:{wall_id:e.wall.id},success:function(){},error:function(){}}),e.isLikedByCurrentUser=!0,e},UNLIKE_PADLET:function(e){return $.ajax({headers:{"X-HTTP-Method-Override":"DELETE"},type:"post",url:"/api/wall_likes",data:{wall_id:e.wall.id},success:function(){},error:function(){}}),e.isLikedByCurrentUser=!1,e}},s={FETCHED_REACTIONS:function(e){return e.reactionsFetched=!0,e},CREATE_REACTION:function(e,t){var n;return n=e.reactions.findWhere({user_id:e.user.id,wish_id:t.wishId,reaction_type:e.wallReactionData.type}),n?n.save({value:t.value}):e.reactions.create({wish_id:t.wishId,value:t.value,reaction_type:e.wallReactionData.type},{success:function(){return ww.store.dispatch({type:"CREATED_REACTION"})}}),e},CREATED_REACTION:function(e){return e},DELETE_REACTION:function(e,t){var n;return n=e.reactions.findWhere({user_id:e.user.id,wish_id:t.wishId}),e.postBeingReactedTo=null,null!=n&&n.destroy(),e},START_EDITING_REACTION:function(e,t){return e.postBeingReactedTo=t.wishId,e},STOP_EDITING_REACTION:function(e){return e.postBeingReactedTo=null,e},NEW_REACTION_REMOTE:function(e,t){return e.reactions.add(t.reactionAttributes),e},EDIT_REACTION_REMOTE:function(e,t){var n;return n=e.reactions.get(t.reactionAttributes.id),n&&n.get("updated_at")<=t.reactionAttributes.updated_at&&null!=n&&n.set(t.reactionAttributes),e},DELETE_REACTION_REMOTE:function(e,t){return null!=e.postBeingReactedTo&&e.postBeingReactedTo.id===t.reactionAttributes.id&&(e.postBeingReactedTo=null),e.reactions.remove(t.reactionAttributes.id),e}},e={FETCHED_COMMENTS:function(e){return e.commentsFetched=!0,e},CREATE_COMMENT:function(e,t){return e.comments.create(t.commentAttributes,{success:function(){return ww.store.dispatch({type:"CREATED_COMMENT"})}}),e},CREATED_COMMENT:function(e){return e},EDIT_COMMENT:function(e,t){var n;return n=e.comments.get(t.commentAttributes.id),n.set(t.commentAttributes),n.save(),e.commentBeingEdited=null,e},DELETE_COMMENT:function(e,t){var n;return n=e.comments.get(t.commentId),null!=n&&n.destroy(),e},TOGGLE_COMMENT_ACTION_MENU:function(e,t){return null!=e.commentUnderAction?e.commentUnderAction=null:e.commentUnderAction=e.comments.get(t.commentId),e},HIDE_COMMENT_ACTION_MENU:function(e){return e.commentUnderAction=null,e},START_EDITING_COMMENT:function(e,t){return e.commentBeingEdited=e.comments.get(t.commentId),e},STOP_EDITING_COMMENT:function(e){return e.commentBeingEdited=null,e},NEW_COMMENT_REMOTE:function(e,t){return e.comments.add(t.commentAttributes),e},EDIT_COMMENT_REMOTE:function(e,t){var n;return n=e.comments.get(t.commentAttributes.id),n&&n.get("updated_at")<=t.commentAttributes.updated_at&&null!=n&&n.set(t.commentAttributes),e},DELETE_COMMENT_REMOTE:function(e,t){return null!=e.commentBeingEdited&&e.commentBeingEdited.id===t.commentAttributes.id&&(e.commentBeingEdited=null),null!=e.commentUnderAction&&e.commentUnderAction.id===t.commentAttributes.id&&(section.commentUnderAction=null),e.comments.remove(t.commentAttributes.id),e}},u={FETCHED_SECTIONS:function(e){return e.wallSectionsFetched=!0,e},START_WITH_NO_SECTIONS:function(e){return 0===e.wallSections.length&&(e.sectionBeingEdited=new Wallwisher.Models.WallSection({wall_id:e.wall.id,sort_index:ww.sectionSorter.getBottomSortIndex()}),e.wallSections.add(e.sectionBeingEdited)),e},START_NEW_SECTION:function(e,t){var n,r;return(null!=(n=e.sectionBeingEdited)?n.hasEmptyTitle():void 0)&&(e.sectionBeingEdited.destroy(),e.sectionBeingEdited=null),r=t.section,e.wallSections.add(r),e.sectionBeingEdited=r,e},CREATE_SECTION:function(e){var t,n;return n=e.wall,t=new Wallwisher.Models.WallSection({wall_id:n.id}),e.wallSections.create(t),e},DELETE_SECTION:function(e,t){var n;return null!=(n=t.section)&&n.destroy(),e},TOGGLE_SECTION_ACTION_MENU:function(e,t){return e.sectionUnderAction?e.sectionUnderAction=null:e.sectionUnderAction=t.section,e},HIDE_SECTION_ACTION_MENU:function(e){return e.sectionUnderAction=null,e},START_EDITING_SECTION:function(e,t){return e=this.STOP_EDITING_SECTION(e,t),e.sectionBeingEdited=t.section,e},STOP_EDITING_SECTION:function(e){var t;return null==(null!=(t=e.sectionBeingEdited)?t.id:void 0)&&e.wallSections.remove(e.sectionBeingEdited),e.sectionBeingEdited=null,e},CHANGE_SECTION_TITLE:function(e,t){var n,r;return r=t.section,n=t.title,r.get("title")!==n&&(r.set({title:n}),r.save()),r===e.sectionBeingEdited&&(e.sectionBeingEdited=null),e},CHANGE_SECTION_COLOR:function(e,t){var n;return n=t.section,n.save("color",t.newBgColor),e},REMOVE_SECTION_COLOR:function(e,t){var n;return n=t.section,n.save("color",""),e},SORTED_SECTION:function(e,t){var n;return n=e.wallSections.get(t.sectionId),n&&(n.set({sort_index:t.sortIndex}),n.save()),e},FETCH_DESTINATION_WALL_SECTIONS:function(e,t){var n;return n=t.wallId,e.destinationWallSections=new Wallwisher.Collections.WallSections([],{wallId:n}),e.destinationWallSectionsFetched=!1,e.destinationWallSections.fetch({reset:!0,success:function(){return i.store.dispatch({type:"FETCHED_DESTINATION_WALL_SECTIONS"})}}),e},FETCHED_DESTINATION_WALL_SECTIONS:function(e){return e.destinationWallSectionsFetched=!0,e},NEW_SECTION_REMOTE:function(e,t){return e.wallSections.add(t.sectionAttributes),e},EDIT_SECTION_REMOTE:function(e,t){var n;return n=e.wallSections.get(t.sectionAttributes.id),n&&n.get("updated_at")<=t.sectionAttributes.updated_at&&n.set(t.sectionAttributes),e},DELETE_SECTION_REMOTE:function(e,t){return e.wallSections.remove(t.sectionAttributes.id),e}},t={FETCHED_CONNECTIONS:function(e){return e.postConnectionsFetched=!0,e},COMPLETE_CONNECTION:function(e,t){var n;return n=new Wallwisher.Models.WishConnection({from_wish_id:e.postToConnectFrom.id,to_wish_id:t.postToConnectTo.id,label:t.label}),e.postConnections.create(n),e.postToConnectFrom=null,e},START_CONNECTION:function(e,t){return e.postToConnectFrom=t.postToConnectFrom,e},CANCEL_CONNECTION:function(e){return e.postToConnectFrom=null,e},NEW_CONNECTION_REMOTE:function(e,t){return e.postConnections.add(t.connectionAttributes),e},DELETE_CONNECTION_REMOTE:function(e,t){return e.postConnections.remove(t.connectionAttributes.id),e},START_DISCONNECTION:function(e,t){return e.postToDisconnectFrom=t.postToDisconnectFrom,e},CANCEL_DISCONNECTION:function(e){return e.postToDisconnectFrom=null,e},COMPLETE_DISCONNECTION:function(e,t){var n;return n=e.postConnections.get(t.connectionId),e.postToDisconnectFrom=null,null!=n&&n.destroy(),e}},h={RESIZE_WINDOW:function(e,t){return e.windowWidth=t.width,e.windowHeight=t.height,e},SETTINGS_SHOW:function(e){return e.settingsPanel=!0,e.previewAttributes=$.extend(!0,{},e.wall.attributes),e},SETTINGS_HIDE:function(e){return e.settingsPanel=!1,e.isFirstViewFlow=!1,delete e.previewAttributes,e.wallLayout=e.wall.attributes.viz,e.wallColorScheme=e.wall.attributes.color_scheme,e.wallShowAuthor=e.wall.attributes.show_author,e.wallIsCommentable=e.wall.attributes.is_commentable,e.wallIsReactable=e.wall.attributes.is_reactable,e.wallReactionData=e.wall.attributes.reaction_data,e.wallNewPostLoc=e.wall.attributes.new_wish_loc,e},SETTINGS_TOGGLE:function(e){return e.settingsPanel?this.SETTINGS_HIDE(e):this.SETTINGS_SHOW(e)},SETTINGS_NAVIGATE:function(e,t){return e.settingsActivePanel=t.panelName,e},SETTINGS_UPDATE:function(e,t){return e.previewAttributes=$.extend(!0,{},t.previewAttributes),e.wallLayout=e.previewAttributes.viz,e.wallColorScheme=e.previewAttributes.color_scheme,e.wallShowAuthor=e.previewAttributes.show_author,e.wallIsCommentable=e.previewAttributes.is_commentable,e.wallIsReactable=e.previewAttributes.is_reactable,e.wallReactionData=e.previewAttributes.reaction_data,e.wallNewPostLoc=e.previewAttributes.new_wish_loc,e},FETCHED_BACKGROUND_META:function(e,t){return e.previewAttributes.background=$.extend(e.previewAttributes.background,{dominant_color_as_rgb:t.dominant_color_as_rgb,luminance_name:t.luminance_name}),e},USERINFO_SHOW:function(e){return e.userPanel=!0,e},USERINFO_HIDE:function(e){return e.userPanel=!1,e},USERINFO_TOGGLE:function(e){return e.userPanel?this.USERINFO_HIDE(e):this.USERINFO_SHOW(e)},FIRSTVIEW_GOTO_SHARE:function(e,t){return this.SETTINGS_HIDE(e,t),l.SHARE_SHOW(e,t),e.firstViewPosting=!1,e.isFirstViewFlow=!0,e},FIRSTVIEW_GOTO_SETTINGS:function(e,t){return l.SHARE_HIDE(e,t),this.SETTINGS_SHOW(e,t),e.isFirstViewFlow=!0,e},FIRSTVIEW_GOTO_POSTING:function(e,t){return l.SHARE_HIDE(e,t),e.isFirstViewFlow=!0,e.firstViewPosting=!0,e},FIRSTVIEW_START:function(e,t){return this.FIRSTVIEW_GOTO_SETTINGS(e,t)},FIRSTVIEW_FINISH:function(e,t){return this.SETTINGS_HIDE(e,t),l.SHARE_HIDE(e,t),e.firstViewPosting=!1,e},ENTER_FULLSCREEN:function(e){return e.isFullscreen=!0,e},EXIT_FULLSCREEN:function(e){return e.isFullscreen=!1,e},HIDE_CONTRIBUTORS_LIST:function(e){return e.contributorsList=!1,e},SHOW_CONTRIBUTORS_LIST:function(e){return e.contributorsList=!0,e},REMAKE_SHOW:function(e){return e.remakePanel=!0,e},REMAKE_HIDE:function(e){return e.remakePanel=!1,e},CONVERT_LAYOUT_SHOW:function(e){return e.convertLayoutPanel=!0,e},CONVERT_LAYOUT_HIDE:function(e){return e.convertLayoutPanel=!1,e},CONVERT_LAYOUT_FAILED:function(e,t){var n;return e.wallErrorMessage=t.errorMessage,null!=(n=ww.nativeBridge)&&n.postMessage({message_type:"convert_layout_result",status:"error",error_reason:t.errorMessage}),e},CONVERT_LAYOUT_UPDATE:function(e,t){var n,r;return r=e.wall,n=t.newLayout,r.convertLayout(n).then(function(){return function(){var e;return null!=(e=ww.nativeBridge)?e.postMessage({message_type:"convert_layout_result",status:"success"},function(){return window.location.reload()}):void 0}}(this)).fail(function(){return function(){return ww.store.dispatch({type:"CONVERT_LAYOUT_FAILED",errorMessage:"Failed to convert layout."})}}(this)),e}},o={PADLETSELECTOR_READY:function(e){return e.wallSelectorReady=!0,e},PADLETSELECTOR_SELECT:function(e,t){return e.selectedWallId=t.wallId,e.selectedWallUrl=t.wallUrl,e.selectedWallLayout=t.wallLayout,e},PADLETSELECTOR_DONE:function(e){return e.selectedWallId=e.selectedWallUrl=e.selectedWallLayout=null,e.wallSelectorReady=!1,e}},h=$.extend(h,l,a,n,r,f,s,e,u,t,o),d=function(e,t){var n,r,o,a;if(h[t.type])return h[t.type]($.extend(!0,{},e),t);switch(t.type){case i.statesman.ActionTypes.INIT:return $.extend({},e);case"TOOLMENU_TOGGLE":return $.extend({},e,{toolMenu:!e.toolMenu});case"TOOLMENU_HIDE":return $.extend({},e,{toolMenu:!1});case"CONNECTIVITY_ONLINE":return $.extend({},e,{isOnline:!0});case"CONNECTIVITY_OFFLINE":return $.extend({},e,{isOnline:!1});case"DELETEDIALOG_TOGGLE":return $.extend({},e,{deleteDialog:!e.deleteDialog});case"CLEARALLDIALOG_TOGGLE":return $.extend({},e,{clearAllDialog:!e.clearAllDialog});case"SECTIONPICKERDIALOG_TOGGLE":return n=null!=t.file?t.file:null,a=null!=t.text?t.text:null,r=null!=n?[n]:(null!=(o=t.files)?o.length:void 0)>0?t.files:null,e.sectionPicker=!e.sectionPicker,e.filesToPost=r,e.textToPost=a,e.sectionPicked=null,e;case"SECTIONPICKERDIALOG_DONE":return e.sectionPicked=t.section,e.sectionPicker=!1,e;case"SECTIONPICKED_POSTING_DONE":return e.filesToPost=t.files||null,e.textToPost=t.text||null,e.sectionPicked=null,e;case"HIDE_APP_UPSELL":return $.extend({},e,{showAppUpsell:!1});default:return console.error("Unrecognized action "+t.type),e}},c=$.extend({},window.Wallwisher,{editorHeight:0,posts:new Wallwisher.Collections.Wishes([],{wall:Wallwisher.wall}),postsFetched:!1,reactions:new Wallwisher.Collections.Reactions([],{wall:Wallwisher.wall}),reactionsFetched:!1,postBeingReactedTo:null,comments:new Wallwisher.Collections.Comments([],{wall:Wallwisher.wall}),commentsFetched:!1,commentUnderAction:null,wallSections:new Wallwisher.Collections.WallSections([],{wall:Wallwisher.wall}),wallSectionsFetched:!1,postConnections:new Wallwisher.Collections.WishConnections([],{wall:Wallwisher.wall}),postConnectionsFetched:!1,dpr:Math.ceil(window.devicePixelRatio),windowWidth:$(window).width(),windowHeight:$(window).height(),wallLayout:Wallwisher.wall.attributes.viz,wallColorScheme:Wallwisher.wall.attributes.color_scheme,wallShowAuthor:Wallwisher.wall.attributes.show_author,wallIsCommentable:Wallwisher.wall.attributes.is_commentable,wallIsReactable:Wallwisher.wall.attributes.is_reactable,wallReactionData:Wallwisher.wall.attributes.reaction_data,wallNewPostLoc:Wallwisher.wall.attributes.new_wish_loc,canHaveSections:"shelf"===Wallwisher.wall.attributes.viz,canHaveConnections:"free"===Wallwisher.wall.attributes.viz,settingsPanel:!1,settingsActivePanel:"main",userPanel:!1,isOnline:!0,postBeingEdited:null,isFullscreen:ww.fullscreen.isEnabled(),deleteDialog:!1,clearAllDialog:!1,toolMenu:!1,pendingPosts:[],unreadChatPostPositions:[],sharePanel:!1,sharePanelActiveTab:"privacy",sharePanelActivePanel:"main",sharePanelPrivacyFetched:!1,remakePanel:!1,filePickerPanel:!1,filePickerActivePanel:"main",sectionPicker:!1,transferPostPanel:!1,transferPostActivePanel:"main",copyPostPanel:!1,copyPostActivePanel:"main",selectedWallId:null,selectedWallUrl:null,selectedWallLayout:null,firstViewPosting:!1,contributorsList:!1,convertLayoutPanel:!1,gridSize:$(".wish-sizer").width(),gutterSize:$(".gutter-sizer").width(),inlinePostEdit:!$device.mobile,modalPostEdit:$device.mobile&&!($device.app&&$device.can("postNatively")),nativePostEdit:$device.app&&$device.can("postNatively"),wishListMounted:!1,whoami:"state"}),i.store=i.surfaceStore=new i.statesman.Store(d,c)}).call(this),function(){window.ww||(window.ww={}),ww.StateMixin={respondToStateChangeAndUpdate:function(){return"function"==typeof this.onStateChange&&this.onStateChange(),this.update()},init:function(){var e,t;if(e=this,t=null,e.onStateChange)return e.on("mount",function(){return t=ww.store.subscribe(e.respondToStateChangeAndUpdate)}),e.on("unmount",function(){return"function"==typeof t?t():void 0}),e.onStateChange()}}}.call(this),function(){window.ww||(window.ww={}),ww.AnimateMixin={init:function(){var e;return e=this,e.isMounting=!1,e.on("mount",function(){return e.isMounting=!0,e.root.classList.remove("is-unmounted"),setTimeout(function(){return e.root.classList.add("is-mounted"),e.isMounting=!1},50)})},leave:function(){var e;return e=this,this.root.classList.add("is-unmounted"),e.isMounting?e.unmount():$(this.root).one("transitionend animationend",function(){return e.unmount()})}}}.call(this),function(){window.ww||(window.ww={}),ww.ImageProcessingMixin={imageUrl:ww.imageProcessor.processedUrl}}.call(this),function(){window.ww||(window.ww={}),ww.OutsideEventsMixin={init:function(){var e,t,n;if(n=this,n.onBeforeUnload&&(n.on("mount",function(){return $(window).on("beforeunload",n.onBeforeUnload)}),n.on("unmount",function(){return $(window).off("beforeunload",n.onBeforeUnload)})),n.onOutsideClick&&(n.outsideClickHandler=function(e){return document.body.contains(e.target)&&!n.root.contains(e.target)&&n.onOutsideClick(e),!0},n.on("mount",function(){return setTimeout(function(){return $(document.body).on("click",n.outsideClickHandler)},0)}),n.on("unmount",function(){return $(document.body).off("click",n.outsideClickHandler)})),n.onWindowScroll&&(n.on("mount",function(){return $(window).on("scroll",n.onWindowScroll)}),n.on("unmount",function(){return $(window).off("scroll",n.onWindowScroll)})),n.onEscape&&(t=function(e){if(27===e.keyCode)return n.onEscape(e)},n.on("mount",function(){return setTimeout(function(){return $(document.body).on("keyup",t)})}),n.on("unmount",function(){return $(document.body).off("keyup",t)})),n.onEnter)return e=function(e){if(13===e.keyCode)return n.onEnter(e)},n.on("mount",function(){return setTimeout(function(){return $(document.body).on("keyup",e)})}),n.on("unmount",function(){return $(document.body).off("keyup",e)})},pauseOutsideClickHandler:function(){return $(document.body).off("click",self.outsideClickHandler)},resumeOutsideClickHandler:function(){var e;return e=this,e.outsideClickHandler=function(t){return document.body.contains(t.target)&&!e.root.contains(t.target)&&e.onOutsideClick(t),!0},setTimeout(function(){return $(document.body).on("click",e.outsideClickHandler)},0)}}}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};window.ww||(window.ww={}),ww.ModalMixin={init:function(){var t,n;return n=this,t=e.call(document.documentElement,"ontouchstart")>=0?"touchstart.modal":"click.modal",n.mixin(ww.OutsideEventsMixin),n.on("mount",function(){return $(n.root).on(t,function(e){return this===e.target&&n.cancel(e),!0})}),n.on("unmount",function(){return $(n.root).off(".modal")})},onEscape:function(e){return this.cancel(e),!0}}}.call(this),function(){window.ww||(window.ww={}),ww.DraggableMixin={init:function(){var e;return e=this,e.on("mount",function(){if("free"===ww.store.getState().wallLayout&&e.isEditableByCurrentUser)return e.makeDraggable()}),e.on("updated",function(){return"free"!==ww.store.getState().wallLayout?e.destroyDraggable():e.isEditableByCurrentUser&&!e.isDraggable?e.makeDraggable():void 0}),e.on("before-unmount",function(){return e.destroyDraggable()})},getPositionFromDom:function(){var e;return e=$(this.root),{top:parseInt(e.css("top")),left:parseInt(e.css("left"))}},savePosition:function(e){return ww.store.dispatch({type:"MOVED_POST",post:this.post,position:e})},autoPosition:function(){var e,t,n,r,i;return t=$(".wish-unpos"),t.length>0?(t=t.first(),n=t.get(0).getBoundingClientRect(),i={top:n.top,left:n.right+8}):(e=$(".wish"),r=0,e.each(function(){return r=Math.max(r,this.getBoundingClientRect().bottom)}),r?r+=8:r=100,i={left:8,top:r}),i},destroyDraggable:function(){var e;return null!=(e=$(this.root).off(".draggable").draggable("instance"))&&e.destroy(),this.isDraggable=!1},makeDraggable:function(){var e,t;return t=this,e=$(t.root),e.draggable({containment:[0,0],cancel:"[contenteditable], .ui-resizable-handle, object, embed, input, textarea, button, select, option",cursor:"move",snap:"padlet-post",snapTolerance:4,start:function(){var n;return e.addClass("noclick is-moving"),n=t.root.parentNode.getBoundingClientRect(),e.draggable("option","containment",[n.left,n.top]),e.draggable("instance")._setContainment(),ww.bodySizeListener.expandBodyToAnInsanelyLargeSize()},drag:function(){return jsPlumb.revalidate(t.root)},stop:function(n,r){return _.defer(function(){return function(){return e.removeClass("noclick is-moving")}}(this)),e.removeClass("wish-unpos"),t.savePosition(r.position)}}),t.isDraggable=!0}}}.call(this),function(){window.ww||(window.ww={}),ww.ResizableMixin={init:function(){var e;return e=this,e.on("mount",function(){if("free"===ww.store.getState().wallLayout&&e.isEditableByCurrentUser)return $device.mousable?e.makeResizable():e.makeResizableTouch()}),e.on("updated",function(){return"free"!==ww.store.getState().wallLayout?e.destroyResizable():e.isEditableByCurrentUser&&!e.isResizable?$device.mousable?e.makeResizable():e.makeResizableTouch():void 0}),e.on("before-unmount",function(){return e.destroyResizable()})},saveSize:function(e){return ww.store.dispatch({type:"RESIZED_POST",post:this.post,size:e})},makeResizableTouch:function(){var e,t,n,r,i;return r={x:0,y:0},i=0,n=0,t={},e=$(this.root),e.on("transformstart.resize",t,function(t){return function(n){return t.previewAspectRatio=$("[data-aspect-ratio]",t.root).data("aspect-ratio"),r.x=(n.originalEvent.touches[0].clientX+n.originalEvent.touches[1].clientX)/2,r.y=(n.originalEvent.touches[0].clientY+n.originalEvent.touches[1].clientY)/2,i=e.width(),e.addClass("in-transit")}}(this)),e.on("transform.resize",t,function(t){return function(r){return n=Math.max(i*r.scale,48),e.css("width",n),t.resizeAttachment(n)}}(this)),e.on("transformend.resize",t,function(t){return function(){return t.saveSize({width:n}),e.removeClass("in-transit")}}(this)),this.isResizable=!0},makeResizable:function(){var e,t,n;return n=this,t=e=$(n.root),t.hasClass("ui-resizable")&&t.resizable(!1),t.resizable({minWidth:48,handles:"e,se",resize:function(r,i){var o,a;return o=e.width(),a=i.size.width,o!==a&&e.width(a),n.resizeAttachment(a),t.removeClass("auto-width"),t.css("height","auto"),i.size.width<100?t.addClass("wish-small"):t.removeClass("wish-small"),jsPlumb.revalidate(n.root)},start:function(){return e.addClass("in-transit")},stop:function(t,r){var i;return e.removeClass("in-transit"),i={},i.width=r.size.width,n.saveSize(i)},zIndex:1003}),this.isResizable=!0},destroyResizable:function(){var e,t;return e=$(this.root),null!=(t=e.off(".resize").resizable("instance"))&&t.destroy(),this.isResizable=!1},resizeAttachment:function(e){var t,n,r;return n=e,r=this.getAttachmentAspectRatio(),t=Math.floor(n/r),$(".beethoven-preview-image",this.root).attr({width:n,height:t}),$(".beethoven-inline-embed iframe",this.root).attr({width:n,height:t})},getAttachmentAspectRatio:function(){return $("[data-aspect-ratio]",this.root).data("aspect-ratio")}}}.call(this),function(){window.ww||(window.ww={}),ww.ConnectorsMixin={init:function(){var e;return e=this,e.existingConnections=[],e.on("mount",function(){if("free"===ww.store.getState().wallLayout)return jsPlumb.setContainer(e.root),e.makeConnections(),e.registerDomChangeListenersForConnections()}),e.on("updated",function(){return"free"===ww.store.getState().wallLayout?e.makeConnections():e.destroyConnections()}),e.on("before-unmount",function(){return e.destroyConnections()})},makeConnections:function(){var e;return e=this,_.defer(function(){var t,n,r,i,o;if(o=ww.store.getState(),"free"===o.wallLayout){if(i=_.reject(e.existingConnections,function(e){return o.postConnections.contains(e.cxn)}),i.length>0){for(n=0,r=i.length;n<r;n++)t=i[n],t.jsp.removeOverlay("disconnect"),jsPlumb.deleteConnection(t.jsp);e.existingConnections=_.difference(e.existingConnections,i)}return e.updateConnections(),o.postConnections.each(function(t){var n,r,i,a,s;if(r=_.find(e.existingConnections,function(e){return e.cxn===t}),null!=r){if(i=o.posts.get(t.get("from_wish_id")),s=o.posts.get(t.get("to_wish_id")),o.postToDisconnectFrom===i||o.postToDisconnectFrom===s){if(!r.disconnectOverlay)return n=function(){return $('<div><button class="floating-action-button wish-disconnect-button"><i class="immaterial-icons">close</i></button></div>').on("click",function(){return ww.store.dispatch({type:"COMPLETE_DISCONNECTION",connectionId:t.id})})},r.disconnectOverlay=["Custom",{location:.3,id:"disconnect",create:n}],r.jsp.addOverlay(r.disconnectOverlay)}else if(r.disconnectOverlay)return r.jsp.removeOverlay("disconnect"),delete r.disconnectOverlay}else if(a=e.drawConnection(t.get("from_wish_id"),t.get("to_wish_id"),t.get("label")),null!=a)return e.existingConnections.push({cxn:t,jsp:a})})}})},drawConnection:function(e,t,n){var r,i,o,a;return r=document.getElementById("wish-"+e),a=document.getElementById("wish-"+t),null!=r&&null!=a?(o=[["PlainArrow",{location:1,width:12,length:12}]],n&&o.push(["Label",{label:n,id:"label",cssClass:"wish-connection-label"}]),i=jsPlumb.connect({source:r,target:a,endpoint:"Blank",connector:["Bezier",{
curviness:50}],anchor:"AutoDefault",overlays:o})):null},updateConnections:function(){return jsPlumb.repaintEverything()},destroyConnections:function(){return"undefined"!=typeof jsPlumb&&null!==jsPlumb&&jsPlumb.deleteEveryConnection(),$(this.root).off(".connectors"),$(this.root).off(".connectors","textarea,img")},registerDomChangeListenersForConnections:function(){var e;return e=this,$(e.root).on("input.connectors","textarea",function(){return e.lazyUpdateConnections()}),$(e.root).on("beethoven-load.connectors","img",function(){return e.lazyUpdateConnections()})}},ww.ConnectorsMixin.lazyUpdateConnections=_.debounce(ww.ConnectorsMixin.updateConnections,125)}.call(this),function(){var e,t,n,r,i,o,a;window.ww||(window.ww={}),e=144,n=document.getElementById("wall-container"),t=function(t,n,r){var i,o,a,s,u,l,c,d;return c=r.height(),d=r.width(),c>e&&(s=n.offsetY,l=n.originalEvent.target.getBoundingClientRect().top-r[0].getBoundingClientRect().top,u=s+l,u>e?(a=c-u,a<e?(o=c-e,i=c):(o=u-e/2,i=o+e),r.data("clipTop",o)):(o=0,i=e),r.css("clip","rect("+o+"px, "+d+"px, "+i+"px, 0)")),t.addClass("ui-sortable-clipped")},o=function(e,t,r){var i,o,a,s,u,l,c;return s=r[0].offsetTop,e.removeClass("ui-sortable-clipped"),i=null!=(l=r.data("clipTop"))?l:0,u=null!=(c=r.data("scrollTop"))?c:0,o=r[0].offsetTop,a=o-s,n.scrollTop=u+a+i,r.removeData("clipTop"),r.removeData("scrollTop")},i=function(e,t,r){return r.data("scrollTop",n.scrollTop)},r=function(e){return e.addClass("noclick in-transit")},a=function(e){return e.removeClass("noclick in-transit")},ww.SortMixin={init:function(){var e;return e=this,e.on("mount",function(){var t,n;if(t=ww.store.getState(),n=t.wallLayout,("stream"===n||"matrix"===t.wallLayout)&&t.canIWrite)return e.makeSortable()}),e.on("updated",function(){var t,n;return t=ww.store.getState(),n=t.wallLayout,"stream"!==n&&"matrix"!==n||!t.canIWrite?e.destroySortable():e.makeSortable()}),e.on("before-unmount",function(){return e.destroySortable()})},sortPostsForLayout:function(e){return ww.sorter.sortPosts(e)},makeSortable:function(){var e;if(e=$(this.root),!e.sortable("instance"))return e.sortable({cursor:"move",items:"> .wish-editable",scrollSensitivity:48,cancel:"[contenteditable], .ui-resizable-handle, object, embed, input, button, textarea, select, option",start:function(){return function(n,i){var o;return e.addClass("ui-sortable-sorting"),o=ww.store.getState().wallLayout,"stream"!==o&&"shelf"!==o||(t(e,n,i.item),e.sortable("refreshPositions")),r(i.item)}}(this),beforeStop:function(){return function(t,n){return i(e,t,n.item)}}(this),stop:function(){return function(t,n){var r;return e.removeClass("ui-sortable-sorting"),r=ww.store.getState().wallLayout,"stream"!==r&&"shelf"!==r||o(e,t,n.item),a(n.item)}}(this),update:function(){return function(e,t){return ww.sorter.saveNewIndex(t.item)}}(this)})},destroySortable:function(){var e;return null!=(e=$(this.root).off(".sort").sortable("instance"))?e.destroy():void 0}}}.call(this),function(){var e,t;window.ww||(window.ww={}),e=function(e){return e.addClass("noclick in-transit")},t=function(e){return e.removeClass("noclick in-transit")},ww.SectionOrderSortMixin={init:function(){var e;return e=this,e.on("mount",function(){if("shelf"===ww.store.getState().wallLayout)return e.makeSortable()}),e.on("updated",function(){return"shelf"===ww.store.getState().wallLayout?e.makeSortable():e.destroySortable()}),e.on("before-unmount",function(){return e.destroySortable()})},makeSortable:function(){var n,r;if(r=this,n=$(this.root),!n.sortable("instance"))return n.sortable({axis:"x",cursor:"move",handle:"padlet-section-title",items:"> padlet-section.section-sortable",scrollSensitivity:48,cancel:"[contenteditable], .ui-resizable-handle, object, embed, input, button, textarea",start:function(){return function(t,n){var i;return i=n.item.data("section-id"),null==i&&r.update(),e(n.item)}}(this),stop:function(){return function(e,n){return t(n.item)}}(this),update:function(){return function(e,t){return ww.sectionSorter.saveNewIndex(t.item)}}(this)})},destroySortable:function(){var e;return null!=(e=$(this.root).off(".sort").sortable("instance"))?e.destroy():void 0}}}.call(this),function(){var e,t,n,r,i,o,a,s;window.ww||(window.ww={}),e=144,n=document.getElementById("wall-container"),t=function(t,n,r){var i,o,a,s,u,l,c,d;return c=r.height(),d=r.width(),c>e&&(s=n.offsetY,l=n.originalEvent.target.getBoundingClientRect().top-r[0].getBoundingClientRect().top,u=s+l,u>e?(a=c-u,a<e?(o=c-e,i=c):(o=u-e/2,i=o+e),r.data("clipTop",o)):(o=0,i=e),r.css("clip","rect("+o+"px, "+d+"px, "+i+"px, 0)")),t.addClass("ui-sortable-clipped")},a=function(e,t,r){var i,o,a,s,u,l,c;return s=r[0].offsetTop,e.removeClass("ui-sortable-clipped"),i=null!=(l=r.data("clipTop"))?l:0,u=null!=(c=r.data("scrollTop"))?c:0,o=r[0].offsetTop,a=o-s,n.scrollTop=u+a+i,r.removeData("clipTop"),r.removeData("scrollTop")},o=function(e,t,r){return r.data("scrollTop",n.scrollTop)},r=function(e){return e.addClass("noclick in-transit")},s=function(e){return e.removeClass("noclick in-transit")},i=function(e,t,n){return ww.store.dispatch({type:"SORTED_POST",postId:e,sortIndex:t,sectionId:n})},ww.SectionSortMixin={init:function(){var e;return e=this,e.on("mount",function(){var t,n;if(t=ww.store.getState(),n=t.wallLayout,("stream"===n||"shelf"===n||"matrix"===t.wallLayout)&&t.canIWrite)return e.makeSortable()}),e.on("updated",function(){var t,n;return t=ww.store.getState(),n=t.wallLayout,"stream"!==n&&"shelf"!==n&&"matrix"!==n||!t.canIWrite?e.destroySortable():e.makeSortable()}),e.on("before-unmount",function(){return e.destroySortable()})},sortPostsForLayout:function(e){return ww.sorter.sortPosts(e)},makeSortable:function(){var e,n;if(n=this,e=$(this.root).find(".section-posts"),!e.sortable("instance"))return e.sortable({connectWith:"padlet-section .section-posts",cursor:"move",items:"> .wish-editable",scrollSensitivity:48,cancel:"[contenteditable], .ui-resizable-handle, object, embed, input, button, textarea, select, option",start:function(){return function(n,i){var o;return e.addClass("ui-sortable-sorting"),o=ww.store.getState().wallLayout,t(e,n,i.item),e.sortable("refreshPositions"),r(i.item)}}(this),beforeStop:function(){return function(t,n){return o(e,t,n.item)}}(this),stop:function(){return function(t,n){var r;return e.removeClass("ui-sortable-sorting"),r=ww.store.getState().wallLayout,"stream"!==r&&"shelf"!==r||a(e,t,n.item),s(n.item)}}(this),over:function(){return function(e,t){return t.item.data("newSectionId",n.sectionId)}}(this),change:function(){return function(e,t){var n;return t.item.removeData("prevWishId nextWishId"),n=t.placeholder,t.item.data({prevWishId:n.prev(".wish").attr("id"),nextWishId:n.next(".wish").attr("id")})}}(this),remove:function(){return function(t,n){return n.placeholder.remove(),e.sortable("cancel")}}(this),update:function(){return function(e,t){var r;if(t.item.data("newSectionId")===n.sectionId)return r={},r.sectionId=n.sectionId,r.prevId=t.item.data("prevWishId"),r.nextId=t.item.data("nextWishId"),r.prevId||(r.prevId=null),r.nextId||(r.nextId=null),ww.sorter.saveNewIndex(t.item,r),t.item.removeData("newSectionId prevWishId nextWishId")}}(this)})},destroySortable:function(){var e;return null!=(e=$(this.root).off(".sort").sortable("instance"))?e.destroy():void 0}}}.call(this),function(){window.ww||(window.ww={}),ww.GridMixin={init:function(){var e;return e=this,e.$editingPostElement=null,e.postsLoaded=!1,e.on("mount",function(){if("grid"===ww.store.getState().wallLayout)return e.makeGrid(),e.registerDomChangeListenersForGrid()}),e.on("updated",function(){return"grid"===ww.store.getState().wallLayout?e.grid?e.lazyUpdateGrid():(e.makeGrid(),e.registerDomChangeListenersForGrid()):e.destroyGrid()}),e.on("before-unmount",function(){return e.destroyGrid()})},makeGrid:function(){var e;return this.grid=!0,e=$(this.root),this.shapeshift(),e.on("ss-rearranged",function(e,t){return ww.sorter.saveNewIndex(t)}),e.on("ss-arranged",function(){return e.find(".wish").each(function(){return $(this).attr("data-index",$(this).index()+1)})})},destroyGrid:function(){return $(this.root).off(".grid").trigger("ss-destroy"),delete this.grid,$(this.root).off(".grid","textarea,img")},updateGrid:function(){return this.shapeshift()},shapeshift:function(){var e,t,n,r;if(e=$("#wish-list"),e.trigger("ss-destroy"),0!==e.find(".wish").length)return r=$(".gutter-sizer").width(),t=parseInt(e.css("paddingLeft")),n=parseInt(e.css("paddingTop")),e.shapeshift({selector:".wish",enableDrag:!0,enableCrossDrop:!1,enableResize:!1,enableTrash:!1,dragWhitelist:".wish-editable",gutterX:r,gutterY:r,paddingY:n,paddingX:t})},registerDomChangeListenersForGrid:function(){return $(this.root).on("input.grid","textarea",function(e){return function(){return e.lazyUpdateGrid()}}(this)),$(this.root).on("beethoven-load.grid","img",function(e){return function(){return e.lazyUpdateGrid()}}(this))}},ww.GridMixin.lazyUpdateGrid=_.debounce(ww.GridMixin.updateGrid,125)}.call(this),function(){window.ww||(window.ww={}),ww.SectionSelectorParentMixin={init:function(){var e;return e=this},fetchDestinationWallSections:function(e){return ww.store.dispatch({type:"FETCH_DESTINATION_WALL_SECTIONS",wallId:e})},isSectionsFetched:function(){var e;return e=ww.store.getState(),null!=e.destinationWallSectionsFetched&&e.destinationWallSectionsFetched},destinationWallSections:function(){var e,t;return t=ww.store.getState(),ww.sectionSorter.sortSections((null!=(e=t.destinationWallSections)?e.toArray():void 0)||[])}}}.call(this),function(){var e;ww.store.subscribe(function(){var e,t,n;if(n=ww.store.getState(),n.expandedPostId){if(e="/"+n.wall.get("address")+"/wish/"+n.expandedPostId,window.location.pathname!==e)return history.pushState({expandedPostId:n.expandedPostId},null,e)}else if(e=n.isEmbedded?"/embed/"+n.wall.get("public_key"):"/"+n.wall.get("address"),window.location.pathname!==e)return(null!=(t=history.state)?t.expandedPostId:void 0)?history.pushState({},null,e):history.replaceState({},null,e)}),window.addEventListener("popstate",function(e){var t;return t=e.state,(null!=t?t.expandedPostId:void 0)?ww.store.dispatch({type:"EXPAND_POST",postId:t.expandedPostId}):ww.store.dispatch({type:"UNEXPAND_POST"})}),e=ww.store.getState(),e.expandedPostId&&history.replaceState({expandedPostId:e.expandedPostId},null)}.call(this),function(){var e,t,n,r,i,o,a,s,u,l,c,d,h;t={},r=n=null,o=new Date,i={cover:"cover",tile:"auto",auto:"auto"},a=function(e){return e!==o},u=function(e){var t;return null!=(t=ww.nativeBridge)?t.postMessage({message_type:"padlet_background_update",background_attributes:e}):void 0},s=function(e,t){return ww.beethoven.getAttributes(e,{dpr:1,locale:"en"},function(e){if(!a(t))return e.image_color!==r&&u(e),ww.store.dispatch({type:"FETCHED_BACKGROUND_META",dominant_color_as_rgb:e.image_color,luminance_name:e.image_luminance}),c(e.image_luminance),d(e.image_color,e.image_luminance)})},l=function(e,t){return $('[data-behavior~="background-holder"]').css({backgroundSize:i[t],backgroundImage:"url("+e+")"})},c=function(e){if(e!==n)return n=e,$('[data-behavior~="background-holder"]').attr("data-background-luminance",e)},d=function(e){if(e!==r)return r=e,$("meta[name=theme-color]").attr("content",e),document.documentElement.style.backgroundColor=e},ww.store.subscribe(function(){var e,n,r,i,u,c,d;if(d=ww.store.getState(),e=(null!=(c=d.previewAttributes)?c.background:void 0)||d.wall.get("background"),!_.isEqual(_.pick(t,"url","fill"),_.pick(e,"url","fill")))return o=new Date,r=o,u=ww.imageProcessor.processedUrl(e.url,{preset:"background",width:screen.width,height:screen.height,provider:"beethoven"}),t.url&&!document.body.style.backgroundImage.match(t.url)&&(i=ww.imageProcessor.processedUrl(e.url,{preset:"obscure"}),l(i,"cover")),n=new Image,n.onload=function(){var t;if(!a(r))return t=e.fill&&"undefined"!==e.fill?e.fill:n.width>=800?"cover":"auto",l(u,t),s(e.url,r)},n.src=u,t=$.extend({},e)}),h=ww.store.getState(),e=h.wall.get("background"),null!=e.luminance_name&&c(e.luminance_name),null!=e.dominant_color_as_rgb&&null!=e.luminance_name&&d(e.dominant_color_as_rgb,e.luminance_name),t=e}.call(this),function(){var e,t,n,r;r=ww.store.getState(),e=(null!=(t=r.previewAttributes)?t.color_scheme:void 0)||r.wall.get("color_scheme"),n=function(e){return $("[data-color-scheme]").attr("data-color-scheme",e)},ww.store.subscribe(function(){var e,t;return r=ww.store.getState(),t=r.variant,e=r.wallColorScheme,n(t.indexOf("applet")!==-1?"light":e)})}.call(this),function(){var e,t,n,r;r=ww.store.getState(),e=(null!=(t=r.previewAttributes)?t.font_id:void 0)||r.wall.get("font_id"),n=function(e){return $("[data-font]").attr("data-font",e)},ww.store.subscribe(function(){var e,t,i;return r=ww.store.getState(),i=r.variant,e=(null!=(t=r.previewAttributes)?t.font_id:void 0)||r.wall.get("font_id"),n(e)})}.call(this),function(){var e,t;e=ww.store.getState().wallLayout,t=function(t){if(e!==t)return $("#wall-container").removeClass("free grid stream").addClass(t),document.documentElement.dataset.layout=t,e&&(document.getElementById("wish-list")._tag.unmount(!0),riot.mount("padlet-posts")),e=t},ww.store.subscribe(function(){return t(ww.store.getState().wallLayout)})}.call(this),function(){var e,t,n,r,i,o,a,s,u,l,c;s=ww.store.getState(),l=s.wall,c=s.posts,u=document.getElementById("wish-list"),r=function(){var e,t,n,r,i;return e=$(".wish"),n=document.documentElement.clientWidth,t=document.documentElement.clientHeight,i=u.scrollTop,r=u.scrollLeft,e.each(function(){var e,o,a;if(e=this.getBoundingClientRect(),a=r+e.right,o=i+e.bottom,a>n&&(n=parseInt(1.1*a)),o>t)return t=parseInt(1.1*o)}),{width:n,height:t}},n=function(){},t=function(){var e;return e={width:5*u.clientWidth,height:5*u.clientHeight},$(u).css(e)},e=function(){var e;return e={width:2*u.clientWidth,height:2*u.clientHeight},$(u).css(e)},a=function(){return $(u).css({width:"auto",height:"auto"})},o=function(){if($(window).off(".bodySizeListener"),"free"===l.get("viz"))return $(window).on("resize.bodySizeListener",_.debounce(n,125))},i=function(){return l.on("change:viz",o)},ww.bodySizeListener={expandBodyToIncludeWishes:$.noop,expandBodyToAnInsanelyLargeSize:$.noop,expandBodyToALargerSize:$.noop,resetBodyToWindowSize:$.noop,targetElement:u},o()}.call(this),function(){ww.store.subscribe(function(){var e,t;return t=ww.store.getState(),t.isOnline?$(".offline").remove():(e=$($("#offline-message-tmpl").html()),e.appendTo(document.body))})}.call(this),function(){var e,t,n,r;e=null,n=_.throttle(function(e){return e.classList.remove("is-scrolling"),document.getElementById("surface-header").style.marginLeft=e.scrollLeft+"px"},10),r=function(){if(this.scrollLeft>0)return this.classList.add("is-scrolling"),n(this)},t=function(t){if(e!==t)return"free"===t||"shelf"===t?$("#wall-container").on("scroll.scrollListener",r):$("#wall-container").off(".scrollListener")},ww.store.subscribe(function(){var e;return e=ww.store.getState(),t(e.wallLayout)}),t(ww.store.getState().wallLayout)}.call(this),function(){var e,t,n,r;r=ww.store.getState(),e=(null!=(t=r.previewAttributes)?t.theme_id:void 0)||r.wall.get("theme_id"),ww.store.subscribe(function(){return r=ww.store.getState()}),n=r.isFirstView,n&&ww.store.dispatch({type:"FIRSTVIEW_START"})}.call(this),function(){window.ww||(window.ww={}),ww.boot=function(){var e,t,n,r,i;return"undefined"==typeof ww.willSendCookies||ww.willSendCookies||($(document).ajaxSend(function(e,t){var n;if(n=ww.sessionCookie)return t.setRequestHeader("WW-Session",n)}),$(document).ajaxSuccess(function(e,t){var n;if(n=t.getResponseHeader("WW-Session"))return ww.sessionCookie=n})),Backbone.emulateHTTP=!0,t=ww.store.getState(),ww.store.init(),r=jstz.determine().name(),Cookies.set("ww_tz",r),n=new URI(window.location.toString()),i=null!=(e=n.search(!0))?e.token:void 0,i&&$(document).ajaxSend(function(e,t,n){if(n.crossDomain!==!0)return t.setRequestHeader("X-Access-Token",unescape(i))}),t.posts.fetch({reset:!0,success:function(){return ww.store.dispatch({type:"FETCHED_POSTS"})}}),t.reactions.fetch({reset:!0,success:function(){return ww.store.dispatch({type:"FETCHED_REACTIONS"})}}),t.comments.fetch({reset:!0,success:function(){return ww.store.dispatch({type:"FETCHED_COMMENTS"})}}),t.canHaveSections&&t.wallSections.fetch({reset:!0,success:function(){return ww.store.dispatch({type:"FETCHED_SECTIONS"})}}),t.canHaveConnections&&t.postConnections.fetch({reset:!0,success:function(){return ww.store.dispatch({type:"FETCHED_CONNECTIONS"})}}),ww.realtime=new Wallwisher.Lib.Realtime({user:t.user,wall:t.wall,device:t.deviceId,env:t.environment}),ww.realtime.connect()}}.call(this),function(){var e;e=!0,ww.store.subscribe(function(){var t;return t=ww.store.getState(),t.isFullscreen?(e=!1,ww.fullscreen.enter(),e=!0):(e=!1,ww.fullscreen.exit(),e=!0),$(document).on("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",function(){if(e)return ww.fullscreen.isEnabled()?ww.store.dispatch({type:"ENTER_FULLSCREEN"}):ww.store.dispatch({type:"EXIT_FULLSCREEN"})})})}.call(this),function(){var e,t,n,r,i,o;n=window.ww||(window.ww={}),i={register:{saveSettingsSuccess:function(e){return ww.nativeBridge.saveSettingsSuccess=e},saveSettingsFail:function(e){return ww.nativeBridge.saveSettingsFail=e},settingsChanged:function(e){return ww.nativeBridge.settingsChanged=e},privacyChanged:function(e){return ww.nativeBridge.privacyChanged=e},savePrivacySuccess:function(e){return ww.nativeBridge.savePrivacySuccess=e},savePrivacyFail:function(e){return ww.nativeBridge.savePrivacyFail=e},forwardOnePanel:function(e){return ww.nativeBridge.forwardOnePanel=e},receivingFile:function(e){return ww.nativeBridge.receivingFile=e},saveSettings:function(e){return ww.nativeBridge.saveSettings=e},savePrivacy:function(e){return ww.nativeBridge.savePrivacy=e}},deregister:{saveSettings:function(){return ww.nativeBridge.saveSettings=null}},trigger:{backOnePanel:function(){return $(document).trigger("backOnePanel")},forwardOnePanel:function(e){var t;return"function"==typeof(t=ww.nativeBridge).forwardOnePanel?t.forwardOnePanel(e):void 0},settingsChanged:function(e){var t;return"function"==typeof(t=ww.nativeBridge).settingsChanged?t.settingsChanged(e):void 0},saveSettings:function(){return null!=ww.nativeBridge.saveSettings?ww.nativeBridge.saveSettings():$(document).trigger("saveSettings")},saveSettingsSuccess:function(){var e,t;return(null!=(t=ww.device)?t.can("signalStatusWithLocation"):void 0)?window.location.href="/rn-app/op/success":"function"==typeof(e=ww.nativeBridge).saveSettingsSuccess?e.saveSettingsSuccess():void 0},saveSettingsFail:function(e){var t,n;return(null!=(n=ww.device)?n.can("signalStatusWithLocation"):void 0)?window.location.href="/rn-app/op/fail?error="+encodeURIComponent(e):"function"==typeof(t=ww.nativeBridge).saveSettingsFail?t.saveSettingsFail(e):void 0},savePrivacy:function(){return null!=ww.nativeBridge.savePrivacy?ww.nativeBridge.savePrivacy():$(document).trigger("savePrivacy")},savePrivacySuccess:function(){var e,t;return(null!=(t=ww.device)?t.can("signalStatusWithLocation"):void 0)?window.location.href="/rn-app/op/success":"function"==typeof(e=ww.nativeBridge).savePrivacySuccess?e.savePrivacySuccess():void 0},savePrivacyFail:function(e){var t,n;return(null!=(n=ww.device)?n.can("signalStatusWithLocation"):void 0)?window.location.href="/rn-app/op/fail?error="+encodeURIComponent(e):"function"==typeof(t=ww.nativeBridge).savePrivacyFail?t.savePrivacyFail(e):void 0},receivingFile:function(e){var t;return"function"==typeof(t=ww.nativeBridge).receivingFile?t.receivingFile(e):void 0}}},r={trigger:{convertLayoutSuccess:function(){if(canTriggerLocChange())return window.location.href="/op/panel/close"},convertLayoutFail:function(){if(canTriggerLocChange())return window.location.href="/op/panel/error?error_msg="+encodeURIComponent(error)}}},t={callbacks:{},registerCallback:function(e,t){var n;return null!=(n=ww.nativeBridge.callbacks)?n[e]=t:void 0},deregisterCallback:function(e){var t;return null!=(t=ww.nativeBridge.callbacks)?t[e]=null:void 0},register:{filePickDone:function(e){return ww.nativeBridge.filePickDoneEvent=e},remake:function(e){return ww.nativeBridge.remakeEvent=e}},deregister:{filePickDone:function(){return ww.nativeBridge.filePickDoneEvent=null},remake:function(){return ww.nativeBridge.remakeEvent=null}},dispatch:function(e){return ww.surfaceStore.dispatch(e)},trigger:{createPost:function(){return $(document).trigger("post:create")},filePickDone:function(e){return ww.nativeBridge.filePickDoneEvent?ww.nativeBridge.filePickDoneEvent(e):$(document).trigger("pick:done",e)},remake:function(){return ww.nativeBridge.remakeEvent?ww.nativeBridge.remakeEvent():$(document).trigger("remake")},showConfirm:function(e){var t;return null!=(t=ww.nativeBridge)?t.callbacks.showConfirm(e):void 0},createPostWithMedia:function(e){var t,n,r,i;if(null==e&&(e={}),null!=e.url)return n=ww.surfaceStore.getState(),i=n.wall,r=n.user,t={attachment:e.url},ww.surfaceStore.dispatch({type:"CREATE_POST",post:t})}}},e=null!=(o=n.nativeBridge)?o.addMessageHandler.bind(n.nativeBridge):void 0,e("padlet_settings_update",function(e){var t;return null!=(t=n.surfaceStore)?t.dispatch({type:"SETTINGS_UPDATE",previewAttributes:$.extend(!0,{},e.preview_attributes)}):void 0}),e("padlet_settings_hide",function(){var e;return null!=(e=n.surfaceStore)?e.dispatch({type:"SETTINGS_HIDE"}):void 0}),e("create_post",function(e){var t;return t=e,ww.surfaceStore.dispatch({type:"CREATE_POST",post:t})}),e("cancel_show",function(){var e;return e=ww.surfaceStore.getState(),null!=e.postUnderAction&&ww.surfaceStore.dispatch({type:"HIDE_POST_ACTION_MENU"}),null!=e.sectionUnderAction&&ww.surfaceStore.dispatch({type:"HIDE_SECTION_ACTION_MENU"}),null!=e.commentUnderAction&&ww.surfaceStore.dispatch({type:"HIDE_COMMENT_ACTION_MENU"}),ww.surfaceStore.dispatch({type:"SETTINGS_HIDE"}),ww.surfaceStore.dispatch({type:"SHARE_HIDE"}),ww.surfaceStore.dispatch({type:"REMAKE_HIDE"}),ww.surfaceStore.dispatch({type:"CONVERT_LAYOUT_HIDE"}),ww.surfaceStore.dispatch({type:"END_POST_COPY"}),ww.surfaceStore.dispatch({type:"END_POST_TRANSFER"})}),n.nativeBridge=$.extend(!0,n.nativeBridge||{},t,i,r)}.call(this),function(){var e,t,n,r,i,o,a;i=ww.store.getState(),a=i.wall.id,e=30,t=null,n=function(){return $.get("/api/presence?wall_id="+a)},r=function(){return t=setInterval(n,1e3*e)},o=function(){return clearInterval(t)},$(document).on("visibilitychange",function(){return"visible"===document.visibilityState?(n(),r()):o()}),r()}.call(this),function(){window.ww||(window.ww={}),ww.sorter={getAbsoluteSortIndex:function(e,t){var n;return null==e&&(e=new Date),null==t&&(t=ww.store.getState()),t=ww.store.getState(),n=1024*(e-new Date(t.wall.get("created_at")))},getSortIndex:function(e,t){var n;return null==e&&(e=new Date),null==t&&(t=ww.store.getState()),n=this.getAbsoluteSortIndex(e),"bottom"===t.wall.attributes.new_wish_loc?-n:n},getTopSortIndex:function(){return this.getAbsoluteSortIndex()},getBottomSortIndex:function(){return-this.getAbsoluteSortIndex()},sortPosts:function(e){var t;return t=ww.store.getState(),"chat"===t.wallLayout?_.sortBy(e,function(e){return e.id?e.attributes.created_at:new Date}):_.sortBy(e,function(e){return e.sortIndex()}).reverse()},saveNewIndex:function(e,t){var n,r,i,o,a,s,u,l;return null==t&&(t={}),n=$(e),u=t.sectionId,i=void 0===t.prevId?n.prev(".wish"):null!=t.prevId?$("#"+t.prevId):$([]),r=void 0===t.nextId?n.next(".wish"):null!=t.nextId?$("#"+t.nextId):$([]),a=n.data("post-id"),0!==r.length||0!==i.length?(0===r.length?o=this.getBottomSortIndex():0===i.length&&(s=this.getTopSortIndex()),null==o&&(o=parseInt(r.attr("data-rank"))),null==s&&(s=parseInt(i.attr("data-rank"))),l=parseInt((s+o)/2),ww.store.dispatch({type:"SORTED_POST",postId:a,sortIndex:l,sectionId:u})):null!=u?(l=this.getSortIndex(),ww.store.dispatch({type:"SORTED_POST",postId:a,sectionId:u,sortIndex:l})):void 0}}}.call(this),function(){var e,t;e=200,t=function(){return function(e){var t;return null==e&&(e=ww.store.getState()),t=0,document.querySelectorAll("[data-view-mode='show']").forEach(function(e){return t=Math.max(t,e.getBoundingClientRect().bottom)}),t?t+=8:t=100,{left:8,top:t}}}(this),window.$buildPost=function(){return function(n,r){var i,o,a;return null==n&&(n={}),null==r&&(r=ww.store.getState()),o=new Date,a=r.wall.attributes.viz,"free"!==a||n.position||(n=Object.assign(t(r),n)),i={wall_id:r.wall.id,published:r.canIModerate||!r.wall.privacy.attributes.is_moderated,author_id:r.user.id,width:e,body:n.body||"",subject:n.subject||"",attachment:n.attachment||"",sort_index:n.sortIndex||n.sort_index||ww.sorter.getSortIndex(o,r),created_at:o.toISOString(),wall_section_id:n.wallSectionId||n.wall_section_id,top:n.top,left:n.left}}}(this)}.call(this),function(){window.ww||(window.ww={}),ww.sectionSorter={getSortIndex:function(e){return null==e&&(e=new Date),new Date(e.toISOString()).getTime()/1e3},getTopSortIndex:function(){return-this.getSortIndex()},getBottomSortIndex:function(){return this.getSortIndex()},sortSections:function(e){return _.sortBy(e,function(e){return e.get("sort_index")})},saveNewIndex:function(e,t){var n,r,i,o,a,s,u;if(null==t&&(t={}),n=$(e),i=n.prev("padlet-section"),r=n.next("padlet-section"),0!==r.length||0!==i.length)return 0===r.length?o=this.getBottomSortIndex():0===i.length&&(a=this.getTopSortIndex()),null==o&&(o=parseInt(r.attr("data-rank"))),null==a&&(a=parseInt(i.attr("data-rank"))),u=parseInt((a+o)/2),s=n.data("section-id"),ww.store.dispatch({type:"SORTED_SECTION",sectionId:s,sortIndex:u})}}}.call(this),function(){var e,t,n,r;r=ww.store.getState().wallLayout,!$("html").hasClass("read-only")||"grid"!==r&&"free"!==r||(e=function(){var e,t,n,r,i;return e=$(".wish"),n=document.documentElement.clientWidth,t=document.documentElement.clientHeight,i=0,r=0,e.each(function(){var e,o,a;if(e=this.getBoundingClientRect(),a=r+e.right,o=i+e.bottom,a>n&&(n=parseInt(1.1*a)),o>t)return t=parseInt(1.1*o)}),{width:n,height:t}},n=function(){var t;return t=e(),t.width=Math.max(1024,t.width),t.height=Math.max(1024,t.height),$(document.body).css({width:t.width+"px",height:t.height+"px"})},t=_.debounce(n,250),ww.store.subscribe(t),$(document.body).on("load beethoven-load error beethoven-error",t))}.call(this),function(){}.call(this);